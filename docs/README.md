# KION Event Deduplicator - Документация

## Описание проекта

KION Event Deduplicator - система для дедупликации продуктовых событий. Проект реализован с использованием:

- FastAPI для API сервиса
- Redis для кэширования и дедупликации
- Kafka для потоковой обработки событий
- PostgreSQL для хранения данных

## Запуск на локальном хосте

### Предварительные требования

1. Установите Docker и Docker Compose на вашу систему.
2. Скачайте проект и перейдите в основную директорию проекта.

### Запуск проекта

```bash
# Запуск всех сервисов
docker-compose up --build
```

### Доступные интерфейсы

После успешного запуска, вы сможете получить доступ к следующим ресурсам:

- **База данных (1 шард):** http://localhost:8000/api/ui/database
- **Статистика дедупликатора:** http://localhost:8000/api/ui/stats
- **Swagger API документация:** http://localhost:8000/docs

## Нагрузочное тестирование

Для выполнения нагрузочного тестирования системы выполните следующие шаги:

### Подготовка окружения для тестирования

1. Перейдите в директорию с тестами:

   ```bash
   cd tests/load
   ```
2. Создайте виртуальное окружение Python (если еще не создано):

   ```bash
   python -m venv venv
   ```
3. Активируйте виртуальное окружение:

   ```bash
   # На Windows
   venv\Scripts\activate

   # На Linux/Mac
   source venv/bin/activate
   ```
4. Установите необходимые зависимости:

   ```bash
   pip install locust
   ```

### Запуск нагрузочного тестирования

1. Убедитесь, что вы находитесь в директории `tests/load` с файлом `locustfile.py`.
2. Запустите Locust, указав хост для тестирования:

   ```bash
   locust -f locustfile.py --host=http://localhost:8000
   ```
3. Откройте интерфейс Locust в браузере по адресу:

   ```
   http://localhost:8089
   ```
4. Настройте параметры тестирования:

   - Количество пользователей: 500
   - Частота появления новых пользователей: 100 пользователей/сек
   - Нажмите кнопку "Start swarming", чтобы начать тестирование

### Мониторинг результатов

- В интерфейсе Locust вы сможете наблюдать за RPS (запросы в секунду) проекта и графиком его стабильности.
- Обновляя страницы с базой данных (http://localhost:8000/api/ui/database) и статистикой (http://localhost:8000/api/ui/stats), вы увидите данные, которые отправляются тестером.
